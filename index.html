<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SubSkate</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #87CEEB; /* Gökyüzü rengi */
            font-family: Arial, sans-serif;
            color: white;
        } 
        canvas { 
            display: block; 
        }
        /* Dükkan ve diğer UI elemanları için stil */
        #ui-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start; /* Elemanları sola hizala */
            pointer-events: none; /* UI elemanları Three.js canvasının tıklamasını engellemesin */
            padding: 20px; /* Kenarlardan boşluk */
            box-sizing: border-box; /* Padding dahil boyutu hesapla */
        }
        #shop-button, #score-display {
            pointer-events: auto; /* Tıklama ve etkileşimi etkinleştir */
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #shop-button:hover {
            background-color: rgba(0, 0, 0, 0.9);
        }
        #shop-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            display: none; /* Başlangıçta gizli */
            pointer-events: auto;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }
        #shop-display h2 {
            margin-top: 0;
            color: #FFD700; /* Altın sarısı */
        }
        #shop-display button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
        }
        #shop-display button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div id="ui-container">
        <div id="score-display" style="align-self: flex-end; margin-bottom: auto;">
            Skor: 0<br>Coin: 0
        </div>
        <button id="shop-button" style="align-self: flex-start; margin-top: auto;">Dükkan</button>
    </div>

    <div id="shop-display">
        <h2>Dükkan</h2>
        <p>Burası dükkan! Yakında karakterler, özel güçler ve iksirler burada olacak.</p>
        <button id="close-shop-button">Kapat</button>
    </div>
    
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.165.0/build/three.module.js';

        // --- UI Elemanlarına Erişim ---
        const scoreDisplay = document.getElementById('score-display');
        const shopButton = document.getElementById('shop-button');
        const shopDisplay = document.getElementById('shop-display');
        const closeShopButton = document.getElementById('close-shop-button');

        // --- Shop Butonu Olay Dinleyicisi ---
        shopButton.addEventListener('click', () => {
            shopDisplay.style.display = 'block'; // Dükkanı göster
        });

        closeShopButton.addEventListener('click', () => {
            shopDisplay.style.display = 'none'; // Dükkanı kapat
        });

        // --- Sahne Ayarları ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Sahne arkaplan rengi (gökyüzü)

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 5); // Kamerayı başlangıçta oyuncudan biraz yukarı ve geriye konumlandır

        const renderer = new THREE.WebGLRenderer({ antialias: true }); // Daha pürüzsüz kenarlar için antialias
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- Işıklandırma ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7); // Ortam ışığı
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5); // Yönlü ışık (güneş gibi)
        directionalLight.position.set(0, 10, 5);
        scene.add(directionalLight);

        // --- Zemin Oluşturma (Yol) ---
        const groundGeometry = new THREE.PlaneGeometry(10, 1000); // Geniş, uzun bir düzlem
        const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x556B2F }); // Yeşilimsi kahverengi
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2; // X ekseninde 90 derece döndürerek zemini yatay yap
        ground.position.y = 0; // Zemin seviyesi
        scene.add(ground);

        // --- Oyuncu Küpü Oluşturma ---
        const playerGeometry = new THREE.BoxGeometry(0.8, 1.8, 0.8); // Oyuncu boyutlarında bir küp
        const playerMaterial = new THREE.MeshLambertMaterial({ color: 0xFF4500 }); // Turuncu renk
        const player = new THREE.Mesh(playerGeometry, playerMaterial);
        player.position.set(0, 0.9, 0); // Zeminin biraz üstüne koy (boyunun yarısı kadar)
        scene.add(player);

        // --- Oyun Değişkenleri ---
        const playerSpeed = 0.1; // Oyuncunun ileri hızı
        const laneWidth = 3; // Koridor genişliği (merkezden yana)
        let currentLane = 0; // -1: sol, 0: orta, 1: sağ
        let isJumping = false;
        let jumpVelocity = 0;
        const jumpForce = 0.2;
        const gravity = -0.01;

        let score = 0;
        let coins = 0;

        // --- Klavye Kontrolleri ---
        const keys = {};
        document.addEventListener('keydown', (event) => {
            if (shopDisplay.style.display === 'block') return; // Dükkan açıksa klavye kontrolünü engelle
            keys[event.key.toLowerCase()] = true;
        });
        document.addEventListener('keyup', (event) => {
            keys[event.key.toLowerCase()] = false;
        });

        // --- Dokunmatik Kontroller (Telefon İçin) ---
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (event) => {
            if (shopDisplay.style.display === 'block') return; // Dükkan açıksa dokunmatik kontrolü engelle
            touchStartX = event.touches[0].clientX;
            touchStartY = event.touches[0].clientY;
        }, false);

        document.addEventListener('touchend', (event) => {
            if (shopDisplay.style.display === 'block') return; // Dükkan açıksa dokunmatik kontrolü engelle
            const touchEndX = event.changedTouches[0].clientX;
            const touchEndY = event.changedTouches[0].clientY;

            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            // Dikey kaydırma (zıplama)
            if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > 50) { 
                if (dy < 0 && !isJumping) { // Yukarı kaydırma (zıplama)
                    isJumping = true;
                    jumpVelocity = jumpForce;
                }
                // TODO: Aşağı kaydırma için yuvarlanma/eğilme eklenecek
            } 
            // Yatay kaydırma (şerit değiştirme)
            else if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) { 
                if (dx > 0) { // Sağa kaydırma
                    currentLane = Math.min(currentLane + 1, 1);
                } else { // Sola kaydırma
                    currentLane = Math.max(currentLane - 1, -1);
                }
            }
        }, false);


        // --- Animasyon Döngüsü ---
        function animate() {
            requestAnimationFrame(animate);

            // Dükkan açıksa oyun duraklasın
            if (shopDisplay.style.display === 'block') {
                return; // Oyunu çizme veya güncelleme
            }

            // Skor ve Coin güncelleme (geçici)
            score += Math.floor(playerSpeed * 10); // İleri gittikçe skor artsın
            if (Math.random() < 0.01) { // Rastgele coin çıksın (geçici)
                coins += 1;
            }
            scoreDisplay.innerHTML = `Skor: ${score}<br>Coin: ${coins}`;


            // Oyuncuyu sürekli ileri hareket ettir
            player.position.z -= playerSpeed;
            camera.position.z = player.position.z + 5; // Kamera oyuncuyu takip etsin

            // Oyuncunun şerit pozisyonunu güncelle
            const targetX = currentLane * laneWidth;
            player.position.x += (targetX - player.position.x) * 0.1; // Yumuşak geçiş

            // Zıplama Mantığı
            if (isJumping) {
                player.position.y += jumpVelocity;
                jumpVelocity += gravity; // Yerçekimi uygula

                if (player.position.y <= 0.9) { // Yere düştüğünde
                    player.position.y = 0.9;
                    isJumping = false;
                    jumpVelocity = 0;
                }
            }

            // Klavye ile zıplama
            if (keys[' '] && !isJumping) { // Boşluk tuşu (Spacebar)
                isJumping = true;
                jumpVelocity = jumpForce;
            }

            // Klavye ile yana kayma (A/D veya Sol/Sağ Ok)
            if (keys['a'] || keys['arrowleft']) {
                currentLane = Math.max(currentLane - 1, -1);
                keys['a'] = false; // Tuşu bırakmış gibi yap ki tek basışta bir kere kaydır
                keys['arrowleft'] = false;
            }
            if (keys['d'] || keys['arrowright']) {
                currentLane = Math.min(currentLane + 1, 1);
                keys['d'] = false; // Tuşu bırakmış gibi yap ki tek basışta bir kere kaydır
                keys['arrowright'] = false;
            }

            renderer.render(scene, camera);
        }

        animate();

        // --- Pencere Boyutu Değiştiğinde Yeniden Boyutlandırma ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        console.log("SubSkate: 3D Sahne ve Temel Hareket Başlatıldı!");
    </script>
</body>
</html>
